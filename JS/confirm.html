<style>
    .black{
        background-color: black;
        color:white;
        font-size: 18px;
    }
    .my-pannel {
        position: absolute;
        left: 40%;
        top: 30%;
        width: 400px;
        display: none;
    }
</style>
<div>
    <hr>
    <div class="" style="margin: 0 100px 0 100px">
        <button class="btn btn-default" id="queue" data-status="1">查看队列状态</button>
        <button class="btn btn-danger" id="rename">rename表(Traffic系列)</button>
    </div>
    <hr>
    <div class="display-main row" style="margin: 0 100px 0 100px">
        <div class="col-md-3" id="queue-display" style="height: 200px;text-align: center;padding-top: 40px;"></div>
        <div class="col-md-3" id="rename-display" style="height: 200px;text-align: center;padding-top: 40px;"></div>
    </div>
</div>

<!-- Modal -->
<div class="panel panel-default my-pannel" id="the-pannel">

</div>

<script>
    function Model(msg, mount, callback) {
        this.mount = '#'+mount;
        this.callback = callback;
        this.html = '<div class="panel-heading">'
            + '<strong>' + msg + '</strong>'
            + '</div>'
            + '<div class="panel-body">'
            + '<button class="btn btn-warning" id="sure" style="width: 170px;">确定</button>'
            + '<button class="btn btn-default" id="cancel" style="width: 170px;margin-left: 27px;">取消</button>'
            + '</div>';
    }
    Model.prototype.init = function () {
        $(this.mount).html(this.html);
        $(this.mount).show();

        var that = this;
        $(this.mount).on('click', function (e) {
            e.stopPropagation();
            var id = $(e.target).attr('id');
            if (!id) {
                return false;
            }
            var bool = false;
            if ('sure' == id) {
                bool = true;
            } else if ('cancel' == id) {
                bool = false;
            }
            that.destory();
            that.callback(bool);
        });
    };
    Model.prototype.destory = function () {
        $(this.mount).html('');
        $(this.mount).hide();
        $(this.mount).unbind('click');
    };

    $(function () {
        var socket = io('http://log.lonlife.org:8888');
        var objInter = {
            queue : null
        };

        var display = function (data, id, append) {
            var data = data.split('\n');
            var data = data.join('<br>');
            if (append) {
                $(id).append(data);
            } else {
                $(id).html(data);
            }
        }
        socket.on('queue', function (data) {
            display(data, '#queue-display')
        });

        socket.on('rename', function (data) {
            display(data, '#rename-display', true)
        });

        $('#queue').on('click', function () {
            var status = $(this).data('status');
            if (1 == status) {
                $(this).html('停止查看队列状态');
                objInter.queue = setInterval(function () {
                    socket.emit("queue");
                }, 2000);
                $('#queue-display').addClass('black');
                $('#queue-display').html('准备接收数据');
                $(this).data('status', 2);
            } else if (2 == status) {
                $(this).html('查看队列状态');
                clearInterval(objInter.queue);
                $(this).data('status', 1);
            }
        });

        $('#rename').on('click', function () {
            var model = new Model('确认要rename表么?', 'the-pannel', function (bool) {
                if (bool) {
                    socket.emit('rename');
                }
            });
            model.init();
        });
    });
</script>